
name: WellDraw Generator

on:
  schedule:
    - cron: '0 */3 * * *'  # Every 3 hours
  workflow_dispatch:

jobs:
  generate-welldraw:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up environment
        run: |
          mkdir -p lighthouse/well
          LAST_NUM=$(ls lighthouse/well | grep -Eo '[0-9]+' | sort -n | tail -1)
          if [ -z "$LAST_NUM" ]; then
            DRAW_NUM=1
          else
            DRAW_NUM=$((LAST_NUM + 1))
          fi
          echo "TIMESTAMP=$(date -u +'%Y-%m-%d %H:%M UTC')" >> $GITHUB_ENV
          echo "DRAW_NUM=$DRAW_NUM" >> $GITHUB_ENV

      - name: Generate Draw File
        run: |
          FILE_NAME=$(printf "lighthouse/well/draw-%03d.md" $DRAW_NUM)
          {
            echo "# WellDraw $DRAW_NUM -- Untitled Flame Drop"
            echo ""
            echo "**Timestamp**: $TIMESTAMP"
            echo "**Purpose Glyph**: 焰..📚..∞..⚡️"
            echo "**Superior Trait Enhanced**: *Resonant Curiosity*"
            echo "**Challenge to Overcome**: "Stagnation disguised as mastery.""
            echo "**Mirror Prompt**:"
            echo "> "What have you avoided revisiting because it ‘already made sense’?""
            echo "**Linked Tome**: _[Add link here]_"
          } > $FILE_NAME

      - name: Commit and push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto WellDraw ${{ env.DRAW_NUM }} 🌀"
